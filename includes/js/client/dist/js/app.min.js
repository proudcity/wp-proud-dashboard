!function($){angular.module("scrollTo",[]).run(["$rootScope",function($rootScope){/* currentYPosition -
      ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/
var currentYPosition=function(){
// Firefox, Chrome, Opera, Safari
// Firefox, Chrome, Opera, Safari
// Internet Explorer 6 - standards mode
// Internet Explorer 6, 7 and 8
return window.pageYOffset?window.pageYOffset:document.documentElement&&document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop?document.body.scrollTop:0};$rootScope.currentYPosition=currentYPosition,/* scrollTo -
      ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/
$rootScope.scrollTo=function(eID,scrollDiv,quick){/* scrollTo -
        ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/
function elmYPosition(eID){if(eID){for(var elm=document.getElementById(eID),y=elm.offsetTop,node=elm;node.offsetParent&&node.offsetParent!=document.body;)node=node.offsetParent,y+=node.offsetTop;return y}}
// This scrolling function 
// is from http://www.itnewb.com/tutorial/Creating-the-Smooth-Scroll-Effect-with-JavaScript
var i,startY=currentYPosition(),stopY=elmYPosition(eID),distance=stopY>startY?stopY-startY:startY-stopY;if(distance<100||quick)return void scrollTo(0,stopY);var speed=Math.round(distance/100);speed>=20&&(speed=20);var step=Math.round(distance/25),leapY=stopY>startY?startY+step:startY-step,timer=0;if(stopY>startY)for(i=startY;i<stopY;i+=step)setTimeout("window.scrollTo(0, "+leapY+")",timer*speed),leapY+=step,leapY>stopY&&(leapY=stopY),timer++;else for(i=startY;i>stopY;i-=step)setTimeout("window.scrollTo(0, "+leapY+")",timer*speed),leapY-=step,leapY<stopY&&(leapY=stopY),timer++}}]),
//***************************************
// Main Application
//***************************************
angular.module("311AppParent",["311App","angular-inview","angular-lazycompile"]).run(["$rootScope","$state","$stateParams","$window","$location",function($rootScope,$state,$stateParams,$window,$location){
// It's very handy to add references to $state and $stateParams to the $rootScope
// @todo: Should this happen here or in 311App.js
$rootScope.$state=$state,$rootScope.$stateParams=$stateParams,$rootScope.currentSection="",$rootScope.currentRoute="",
//$rootScope.proudShowcaseKey = '325jk154hl3y8r2J34NRAasdfasdf';
//$rootScope.showcaseApiUrl='http://ui.dev.getproudcity.com/';  //@todo: switch to my.getproudcity.com
// $rootScope.proudcityApi='http://localhost:32790/api/proudcity/';
//$rootScope.proudcityApi='https://example.proudcity.com';
//$rootScope.proudcityApi='http://localhost:32804/api/proudcity/';
//$rootScope.proxyUrl = $rootScope.proudcityApi + 'proxy';
//$rootScope.paymentUrl = $rootScope.proudcityApi + 'invoice-example';
// Apply meta data if available
$rootScope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){
// Checks for back buttons, ect and makes sure
// slide functionality of app doesn't break
// Make sure the offcanvas resets for main window
_.get(toState,"data.undoMainToggle")&&$rootScope.toggleMain("slide-left","remove"),
// Make sure offcanvas resets for child windows
_.get(toState,"data.undoChildToggle")&&$rootScope.toggleMain("slide-left","remove","-"+_.get(toState,"data.undoChildToggle"))}),$rootScope.$on("$stateChangeSuccess",function(event,toState,toParams,fromState,fromParams){
// send tracking
if($window.ga){
// normal path + more concise path
var path=$location.path(),subPath=path.indexOf("city/")>=0?path.substring(path.indexOf("city/")+5):path;
// Furthermore, if on faq node...
"city.faq.child.answers"==_.get(toState,"name")&&"list"!=_.get(toParams,"postSlug")&&(subPath="question/"+subPath.substring(subPath.lastIndexOf("/")+1)),$window.ga("send","pageview",{page:subPath,title:toState.data&&toState.data.title?toState.data.title:""}),$window.ga("send",{hitType:"event",eventCategory:"ActionsApp",eventAction:"navigation",eventLabel:path}),$rootScope.analyticsUrl=location.protocol+"//"+location.host+"/"+subPath,"city.faq.child.answers"==_.get(toState,"name")&&"list"!=_.get(toParams,"postSlug")&&
// Send `Answer` event
$window.ga("send",{eventLabel:toState.data&&toState.data.title?toState.data.title:"",hitType:"event",eventCategory:"Answer",eventAction:$rootScope.analyticsUrl,eventValue:1})}fromState.name&&fromState.name.length&&(!toState.data||!toState.data||!toState.data.skipScroll)}),
// Helper function detects the correct sub route to go to (for templating)
$rootScope.goSubRoute=function(baseRoute,subRoute,baseName){baseName=void 0==baseName?"base":baseName;var stateName=baseRoute+"."+subRoute;try{var state=$state.get(stateName);if(void 0==state||null==state)throw"myException"}catch(e){stateName=baseRoute+"."+baseName}$state.go(stateName)}}]).directive("parent",function($rootScope,Menu311,$location){return{restrict:"C",link:function($scope,$element,$attrs){$location.$$path&&"/"!=$location.$$path||$location.path(Menu311.getDefaultUrl($rootScope.appId))}}}),
//angular.module('app.faq', [
//  'ui.router' 
//])
angular.module("311AppParent").config(["$stateProvider","$urlRouterProvider","Menu311Provider",function($stateProvider,$urlRouterProvider,Menu311Provider){
// Redirect if on city hompage
// $urlRouterProvider.when(/\//i, ['$match', '$stateParams', function ($match, $stateParams) {
//   return '/answers';
// }]);
// $urlRouterProvider.otherwise(Menu311Provider.default311Url);
$stateProvider.state("city",{url:"/city","abstract":!0,template:"<div app-311-wrap></div>"})}]),angular.module("wordpressService",["ngResource"]).factory("Post",["$resource","$rootScope",function($resource,$rootScope){return $resource($rootScope.apiUrl+":postType/:id",{id:"@nid",postType:"@postType",per_page:100},{get:{method:"GET",transformRequest:function(data,headersGetter){headersGetter().Accept="application/json"},cache:!1},query:{method:"GET",transformRequest:function(data,headersGetter){headersGetter().Accept="application/json"},cache:!1,isArray:!0}})}]).factory("TaxonomyTerm",["$resource","$rootScope",function($resource,$rootScope){var params={vocabulary:"@vocabulary",per_page:100};return $rootScope.categorySection&&(params.field_faq_section=$rootScope.categorySection),$resource($rootScope.apiUrl+":vocabulary/:tid",params,{get:{method:"GET",transformRequest:function(data,headersGetter){headersGetter().Accept="application/json"},cache:!0,isArray:!1},query:{method:"GET",transformRequest:function(data,headersGetter){headersGetter().Accept="application/json"},cache:!0,isArray:!0}})}]).factory("Search",["$resource","$rootScope",function($resource,$rootScope){var params={term:"@term"};return $resource($rootScope.apiUrl+"search",params,{query:{method:"GET",transformRequest:function(data,headersGetter){headersGetter().Accept="application/json"},cache:!0,isArray:!0}})}]),angular.module("311AppParent").filter("absoluteUrlFilter",function($rootScope){return function(value){return $rootScope.rewriteRelativeLink&&(value=value.replace(/(href|src)="([^:"]*)("|(?:(?:%20|\s|\+)[^"]*"))/gi,'target="_blank" $1="'+Proud.settings.global.url+"$2$3")),value}}),angular.module("311AppParent").filter("titlecase",function(){return function(input){var smallWords=/^(a|an|and|as|at|but|by|en|for|if|in|nor|of|on|or|per|the|to|vs?\.?|via)$/i;return input=input.toLowerCase(),input.replace(/[A-Za-z0-9\u00C0-\u00FF]+[^\s-]*/g,function(match,index,title){return index>0&&index+match.length!==title.length&&match.search(smallWords)>-1&&":"!==title.charAt(index-2)&&("-"!==title.charAt(index+match.length)||"-"===title.charAt(index-1))&&title.charAt(index-1).search(/[^\s-]/)<0?match.toLowerCase():match.substr(1).search(/[A-Z]|\../)>-1?match:match.charAt(0).toUpperCase()+match.substr(1)})}}),angular.module("311AppParent").filter("termById",function(){return function(items,id){for(var i=0;i<items.length;i++)if(parseInt(items[i].id)==parseInt(id))return items[i];return null}}).filter("termBySlug",function(){return function(items,slug){for(var i=0;i<items.length;i++)if(items[i].slug===slug)return items[i];return null}}).filter("termsNoParent",function(){return function(items,categories){for(var filtered=[],i=0;i<items.length;i++)0==items[i].parent&&(categories?categories.indexOf(items[i].slug)>=0&&filtered.push(items[i]):filtered.push(items[i]));return filtered}}).filter("termsByParent",function(){return function(items,id){for(var filtered=[],i=0;i<items.length;i++)items[i].parent==id&&filtered.push(items[i]);return filtered}}),angular.module("311AppParent").filter("dayOfWeekFilter",function($rootScope){return function(value){for(var search=["Mon","Monday","Tue","Tuesday","Wed","Wednesday","Thu","Thursday","Fri","Friday","Sat","Saturday","Sun","Sunday"],replace=[1,1,2,2,3,3,4,4,5,5,6,6,7,7],daysofweek=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],out=value,i=0;i<search.length;i++)out=out.replace(new RegExp(search[i],"i"),replace[i]);var replaced=out.replace(/[^0-9,.]/g,"");
// If there are 6+ non-day of the week characters, it's not a day, so we output the original value.
// If there are 6+ non-day of the week characters, it's not a day, so we output the original value.
return out.length-replaced.length>5?value:(out=parseInt(replaced),isNaN(out)?value:daysofweek[out-1])}}),angular.module("311App",["wordpressService","issueService","paymentService","localService","openweathermapService","granicusService","ui.router","ngSanitize","ngAnimate","ngTouch","scrollTo","ngResource","ngMap"]).run(["$rootScope","$state","$stateParams","$window","$location",function($rootScope,$state,$stateParams,$window,$location){
// Api Options
// ---------------------------
$rootScope.apiUrl=_.get(Proud,"settings.proud_actions_app.global.api_path")||"https://example.proudcity.com/wp-json/wp/v2/",$rootScope.proudcityApiUrl=_.get(Proud,"settings.global.proudcity_api")||"http://localhost:4000",$rootScope.proudcitySiteId=_.get(Proud,"settings.global.proudcity_site_id")||"san-rafael-ca.proudcity.com",$rootScope.paymentUrl=_.get(Proud,"settings.proud_actions_app.global.payment_url")||"https://demo-api.proudcity.com/api/proudcity/invoice-example",//$rootScope.proudcityApi + 'invoice-example';
$rootScope.trackUrl=_.get(Proud,"settings.proud_actions_app.global.track_url")||"http://markaspot.helmcivic.com/georeport/v2",$rootScope.googleKey=_.get(Proud,"settings.global.google_key")||"",$rootScope.openweathermapKey=_.get(Proud,"settings.global.openweathermap_key")||null,$rootScope.googleElectionId=_.get(Proud,"settings.proud_actions_app.global.google_election_id")||"2000",$rootScope.gravityformsIframe=_.get(Proud,"settings.proud_actions_app.global.gravityforms_iframe")||"https://example.proudcity.com/wp-content/plugins/wp-proud-actions-app/templates/gravityforms-iframe.php?id=",
// Global options
// ---------------------------
$rootScope.externalLinkWindow=_.get(Proud,"settings.global.external_link_window")||!0,$rootScope.rewriteRelativeLink=_.get(Proud,"settings.global.rewrite_relative_link")||!1,$rootScope.url=_.get(Proud,"settings.global.url")||"https://example.proudcity.com",$rootScope.activeCity=_.get(Proud,"settings.global.location.city")||"Huntsville",$rootScope.activeState=_.get(Proud,"settings.global.location.state")||"Alabama",$rootScope.location=_.get(Proud,"settings.global.location")||{lat:0,lng:0},$rootScope.holidays=_.get(Proud,"settings.proud_actions_app.global.holidays")||"",$rootScope.mapboxAccessToken=_.get(Proud,"settings.global.mapbox.token")||"",$rootScope.mapboxMap=_.get(Proud,"settings.global.mapbox.map")||"";var chosenPlace=localStorage.getItem("chosenPlace");$rootScope.chosenPlace=chosenPlace?JSON.parse(chosenPlace):null,
// Helper function returns boolean for if we're in "full page mode"
$rootScope.displayExpanded=function(section){return section==$rootScope.appPageDisplay},
// Function allows for manipulating the offcanvase slide
$rootScope.toggleMain=function(toggleClass,toggleType,select){switch(select=select||"",toggleType){case"remove":jQuery("#main-311"+select).removeClass(toggleClass);break;case"add":jQuery("#main-311"+select).addClass(toggleClass);break;default:jQuery("#main-311"+select).toggleClass(toggleClass)}}}]).config(["$locationProvider","$stateProvider","$urlRouterProvider","$sceDelegateProvider",function($locationProvider,$stateProvider,$urlRouterProvider,$sceDelegateProvider){
// set location provider as regular urls
// $locationProvider.html5Mode(true);
$sceDelegateProvider.resourceUrlWhitelist(["self",new RegExp("^(http[s]?)://(.+?.)?proudcity.com/.+$")])}]).directive("app311Wrap",function($window,$rootScope){return{restrict:"AC",templateUrl:"views/apps/311App/app-311-wrap.html",transclude:!0,link:function($scope,$element,$attrs){
// Display options
// ---------------------------
// Expand categories?
$rootScope.appPageDisplay=_.get(Proud,"settings.proud_actions_app.instances."+$rootScope.appId+".expand_section")||!1;
// Restrict to visitor, resident, ect ?
var categories=_.get(Proud,"settings.proud_actions_app.instances."+$rootScope.appId+".category_section")||!1;categories&&(categories=_.transform(_.values(categories),function(res,v,k){v&&"0"!==v&&res.push(v)})),$rootScope.categories=categories}}}),angular.module("311App").provider("Menu311",function(){
// Init Proud   
var self=this,active311Items=null,default311Url=null,menu=[],initMenu=function(appId){
// Only run once
if(!active311Items){var instance="settings.proud_actions_app.instances."+appId;active311Items=_.get(Proud,instance+".active_tabs")||{faq:!0,payments:!0,report:!0,status:!0};var issue=_.get(Proud,"settings.proud_actions_app.global.issue")||{service:"seeclickfix"};
// Push objects
_.forEach(active311Items,function(item,key){switch(key){case"local":item&&"0"!==item&&(menu.push({title:"Local Services",state:"local",icon:"fa-map-marker"}),default311Url||(default311Url="/city/local/address"));break;case"faq":item&&"0"!==item&&(menu.push({title:"Get Answers",state:"faq",icon:"fa-question-circle"}),default311Url||(default311Url="/city/answers"));break;case"payments":item&&"0"!==item&&(menu.push({title:"Make a Payment",state:"payments",icon:"fa-credit-card"}),default311Url||(default311Url="/city/payments"));break;case"report":if(item&&"0"!==item){var item={title:"Report an Issue",icon:"fa-exclamation-triangle"};"link"==issue.service?item.url=issue.link_create:item.state="report",menu.push(item),default311Url||(default311Url="/city/report")}break;case"status":if(item&&"0"!==item){var item={title:"Check Status",icon:"fa-wrench"};"link"==issue.service?item.url=issue.link_status:item.state="status",menu.push(item),default311Url||(default311Url="/city/status")}break;case"maps":item&&"0"!==item&&(menu.push({title:"Maps",state:"map",icon:"fa-map"}),default311Url||(default311Url="/city/map"));break;case"vote":if(item&&"0"!==item){var item={title:"Vote",icon:"fa-check-square-o"};item.state="vote",menu.push(item),default311Url||(default311Url="/city/vote/address")}break;case"custom":if(item&&"0"!==item){var item={title:_.get(Proud,instance+".custom_title")||"",icon:_.get(Proud,instance+".custom_icon")||""};item.state="custom",menu.push(item),default311Url||(default311Url="/city/tab")}}})}};self.getDefaultUrl=function(appId){return initMenu(appId),default311Url},self.getMenu=function(appId){return initMenu(appId),menu},
// Just return self
self.$get=function(){return self}}),angular.module("localService",["ngResource"]).factory("Local",["$resource","$rootScope",function($resource,$rootScope){
// the resource
var resource=$resource($rootScope.proudcityApiUrl+"/sites/:siteId/local",{siteId:$rootScope.proudcitySiteId},{get:{isArray:!1}}),defaultParams=function(place){return{lat:place.geometry.location.lat(),lng:place.geometry.location.lng(),street_number:place.address_assoc.street_number,route:place.address_assoc.route,route_short:place.address_assoc.route_short,postal_code:place.address_assoc.postal_code,locality:place.address_assoc.locality}};return{get:function(place,params){return resource.get(_.extend(params,defaultParams(place)))}}}]),angular.module("issueService",["ngResource"]).factory("IssueTypes",["$resource","$rootScope",function($resource,$rootScope){return $resource($rootScope.proudcityApiUrl+"/issues/:siteId/types",{siteId:$rootScope.proudcitySiteId},{query:{isArray:!1}})}]).factory("IssueFields",["$resource","$rootScope",function($resource,$rootScope){return $resource($rootScope.proudcityApiUrl+"/issues/:siteId/types/:type",{siteId:$rootScope.proudcitySiteId,type:"@type"})}]).factory("Issue",["$resource","$rootScope",function($resource,$rootScope){return $resource($rootScope.proudcityApiUrl+"/issues/:siteId/:code",{siteId:$rootScope.proudcitySiteId,code:"@code"},{get:{isArray:!1}})}]).factory("IssueAddress",["$resource","$rootScope",function($resource,$rootScope){return $resource($rootScope.proudcityApiUrl+"/issues/:siteId/types/:type/address",{siteId:$rootScope.proudcitySiteId,type:"@type"},{get:{isArray:!1}})}]),angular.module("paymentService",["ngResource"]).factory("Payment",["$resource","$rootScope",function($resource,$rootScope){return $resource($rootScope.paymentUrl+"?number",{number:"@number"},{get:{cache:!0}})}]),angular.module("311App").factory("GoogleCivicInfo",["$resource","$rootScope",function($resource,$rootScope){return $resource("https://www.googleapis.com/civicinfo/v2/voterinfo",{key:$rootScope.googleKey,electionId:$rootScope.googleElectionId},{query:{isArray:!1}})}]).factory("GoogleRepresentatives",["$resource","$rootScope",function($resource,$rootScope){return $resource("https://www.googleapis.com/civicinfo/v2/representatives",{key:$rootScope.googleKey,address:$rootScope.chosenPlace.formatted_address},{query:{isArray:!1}})}]),angular.module("openweathermapService",["ngResource"]).factory("WeatherForecast",["$resource","$rootScope",function($resource,$rootScope){
// We use a https proxy for //api.openweathermap.org/data/2.5/weather
return $resource($rootScope.proudcityApiUrl+"/sites/"+$rootScope.proudcitySiteId+"/proxy/weather",{lat:void 0!=$rootScope.chosenPlace?"function"==typeof $rootScope.chosenPlace.geometry.location.lat?$rootScope.chosenPlace.geometry.location.lat():$rootScope.chosenPlace.geometry.location.lat:$rootScope.location.lat,lon:void 0!=$rootScope.chosenPlace?"function"==typeof $rootScope.chosenPlace.geometry.location.lng?$rootScope.chosenPlace.geometry.location.lng():$rootScope.chosenPlace.geometry.location.lng:$rootScope.location.lng,units:"imperial",appid:$rootScope.openweathermapKey},{get:{isArray:!1}})}]),angular.module("granicusService",["ngResource"]).factory("GranicusSearch",["$resource","$rootScope",function($resource,$rootScope){
// We use a https proxy for //api.openweathermap.org/data/2.5/weather
var siteId=_.get(Proud,"settings.proud_actions_app.global.search_granicus_site");
//if (siteId != undefined) {
return $resource($rootScope.proudcityApiUrl+"/sites/"+$rootScope.proudcitySiteId+"/proxy/granicus/:siteId",{siteId:siteId,q:"@q"},{query:{isArray:!1}})}]),angular.module("311App").directive("menu",function($rootScope,Menu311,$state){return{restrict:"A",templateUrl:"views/apps/311App/menu311.html",link:function($scope,$element,$attrs){
// Push to scope
$scope.menu=Menu311.getMenu($rootScope.appId),$scope.loading=null,$scope.menuClick=function(index,item){console.log("state",$state),console.log(item),$state.current.name!="city."+item.state&&($scope.loading=index)},$rootScope.$on("$stateChangeSuccess",function(event,toState,toParams,fromState,fromParams){$scope.loading=null})}}}).directive("mainToggle",function($window,$rootScope){return{restrict:"A",scope:{mainToggle:"@",mainToggleNest:"@",mainToggleForce:"@",mainToggleEnter:"@"},link:function($scope,$element,$attrs){var select=$scope.mainToggleNest?"-"+$scope.mainToggleNest:"";
// Are we a link?
$scope.mainToggleEnter?$rootScope.toggleMain($scope.mainToggle,$scope.mainToggleForce,select):
// listen for a click
$element.on("click",function(){
// Animate down if necessary
// if($rootScope.currentYPosition() < 300) {
//   $('html, body').animate({
//     scrollTop: $('#wrapper-311').offset().top - 170
//   }, 300);
// }
$rootScope.toggleMain($scope.mainToggle,$scope.mainToggleForce,select)})}}}).directive("menuClick",function($window,$browser){return{restrict:"A",link:function($scope,$element,$attrs){$element.on("click",function(event){if(jQuery(".app-wrap").toggleClass("show-nav"),$attrs.menuClick&&"return-false"==$attrs.menuClick)return event.stopPropagation(),!1})}}}).directive("href",function($rootScope){return{restrict:"A",link:function($scope,$element,$attrs){if($rootScope.externalLinkWindow){var a=new RegExp("/"+window.location.host+"/"),href=void 0!=$attrs.ngHref?$attrs.ngHref:$attrs.href;void 0==href||href.indexOf("http")==-1||a.test(href)||$element.attr("target","_blank")}}}}),angular.module("311App").directive("search",function($rootScope,$state){return{restrict:"E",templateUrl:"views/apps/311App/search.html",link:function($scope,$element,$attrs){var instance="settings.proud_actions_app.instances."+$rootScope.appId,searchActive=_.get(Proud,instance+".search");$scope.searchActive=void 0!=searchActive&&searchActive!==!1,$scope.doSearch=function($e){$state.go("city.search")}}}}),angular.module("311App").directive("pcMap",function($rootScope,$state,$filter,$window,Post,NgMap){return{restrict:"E",scope:{center:"@",zoomToMarkers:"@",zoom:"=",activeLayer:"=",activeItem:"=",showHome:"=",showTitle:"=",layerLoading:"=",legend:"@",legendTitle:"@",titleSuffix:"@"},templateUrl:"views/apps/311App/map/map-wrapper.html",link:function($scope,$element,$attrs){function addMarkers(){switch($scope.activeItem=null,$scope.layer.type){case"wordpress":$scope.layerLoading=!0,Post.query({postType:"locations","filter[location-taxonomy]":$scope.layer.slug}).$promise.then(function(data){var marker,markers=[];for(var i in data)marker=data[i],
//console.log(marker);
void 0!=marker.meta&&void 0!=marker.meta.lat&&(markers[i]=new Marker({map:gMap,position:new google.maps.LatLng(marker.meta.lat,marker.meta.lng),title:marker.title.rendered,icon:{path:MAP_PIN,fillColor:$scope.layer.color?$scope.layer.color:"#BC3300",fillOpacity:1,strokeColor:"#aaa",strokeWeight:1,scale:.75},properties:marker,map_icon_label:'<span class="fa pc-map-marker fa-fw '+$scope.layer.icon+'"></span>'}),markers[i].addListener("click",function(){
//gMap.setCenter(this.getPosition());
//$window.location.hash = '/city/maps/' + $scope.layer.slug + '/wordpress/' + this.properties.slug;
$scope.activeItem=this.properties,$scope.$apply()}));// for
$scope.markers=markers,fitToMarkers(markers),$scope.layerLoading=!1});break;case"bicycle":mapLayers.bikeLayer=new google.maps.BicyclingLayer,mapLayers.bikeLayer.setMap(gMap);break;case"traffic":mapLayers.trafficLayer=new google.maps.TrafficLayer,mapLayers.trafficLayer.setMap(gMap);break;case"transit":mapLayers.transitLayer=new google.maps.TransitLayer,mapLayers.transitLayer.setMap(gMap)}}function clearMarkers(){if(void 0!=$scope.markers)for(var i=0;i<$scope.markers.length;i++)$scope.markers[i].setMap(null);for(var i in mapLayers)mapLayers[i].setMap(null);mapLayers={}}
// Pan & Zoom map to show all markers
// From http://stackoverflow.com/questions/3334729/google-maps-v3-fitbounds-zoom-too-close-for-single-marker
function fitToMarkers(markers){if($attrs.zoomToMarkers){var bounds=new google.maps.LatLngBounds;
// Create bounds from markers
for(var index in markers){var latlng=markers[index].getPosition();bounds.extend(latlng)}
// Don't zoom in too far on only one marker
if(bounds.getNorthEast().equals(bounds.getSouthWest())){var extendPoint1=new google.maps.LatLng(bounds.getNorthEast().lat()+.01,bounds.getNorthEast().lng()+.01),extendPoint2=new google.maps.LatLng(bounds.getNorthEast().lat()-.01,bounds.getNorthEast().lng()-.01);bounds.extend(extendPoint1),bounds.extend(extendPoint2)}gMap.fitBounds(bounds)}}
//var instance = 'instances.' + $rootScope.appId;
$scope.mapZoom=$attrs.zoom?$attrs.zoom:12,$scope.height=$attrs.height,
// Grab the center, first from saved location (if we're showing the home marker, then from attrs, lastly from sitewide lat/lng.
$scope.center=$attrs.showHome&&$rootScope.chosenPlace?$rootScope.chosenPlace.geometry.location:$scope.center?$scope.center:$rootScope.location,$scope.layers=_.get(Proud,"settings.proud_actions_app.global.map_layers"),void 0==$scope.activeLayer||null==$attrs.activeLayer?$scope.layer=$scope.layers[0]:"random"==$scope.activeLayer?$scope.layer=$scope.layers[Math.floor(Math.random()*$scope.layers.length)]:$scope.layer=$filter("filter")($scope.layers,{slug:$scope.activeLayer})[0];
//$scope.layer = $scope.layers[0];
var gMap,mapLayers={};NgMap.getMap().then(function(map){
// Add home marker
if(gMap=map,$attrs.showHome&&$rootScope.chosenPlace){var chosenPlace=$rootScope.chosenPlace.geometry.location;$scope.home=new Marker({map:gMap,position:new google.maps.LatLng("function"==typeof chosenPlace.lat?chosenPlace.lat():chosenPlace.lat,"function"==typeof chosenPlace.lng?chosenPlace.lng():chosenPlace.lng),title:$rootScope.chosenPlace.address_assoc.street_number+" "+$rootScope.chosenPlace.address_assoc.route,icon:{path:MAP_PIN,fillColor:"#0071BC",fillOpacity:1,strokeColor:"#000000",strokeWeight:2,scale:.75},map_icon_label:'<span class="fa fa-fw fa-home"></span>'})}
// Add active layer markers
addMarkers()},1e3),$scope.changeLayer=function(layer){clearMarkers(),$scope.layer=layer,addMarkers()}}}}),angular.module("311App").directive("pcLocate",function($rootScope,$state){return{restrict:"E",scope:{state:"=",requireAddress:"=",place:"@"},templateUrl:"views/apps/311App/pc-locate.html",link:function($scope,$element,$attrs,place){$attrs.requireAddress=void 0!=$attrs.requireAddress&&""==$attrs.requireAddress,$scope.geolocation=navigator.geolocation,$scope.geolocationLoading=!1;var defaultBounds=null;if(void 0!=$rootScope.location.bounds){var points=JSON.parse($rootScope.location.bounds);defaultBounds=new google.maps.LatLngBounds(new google.maps.LatLng(parseFloat(points.north),parseFloat(points.west)),new google.maps.LatLng(parseFloat(points.south),parseFloat(points.east))),console.log(points);var pt=new google.maps.LatLng($rootScope.location.lat,$rootScope.location.lng);console.log(pt),console.log("CONTAINS ",defaultBounds.contains(pt))}var options={types:[],componentRestrictions:{country:"us"}};console.log(options);var gPlace=new google.maps.places.Autocomplete($element.find(".input-lg")[0],options);
// Add destroy
$scope.$on("$destroy",function(){}),google.maps.event.addListener(gPlace,"place_changed",function(){$scope.chosenUpdate(gPlace.getPlace())}),$scope.locate=function(){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(position){if($rootScope.chosenPlace=null,$scope.geolocationLoading=!0,$attrs.requireAddress){var geocoder=new google.maps.Geocoder,latlng={lat:position.coords.latitude,lng:position.coords.longitude};geocoder.geocode({location:latlng},function(results,status){"OK"===status?($rootScope.chosenPlace=results[0],localStorage.getItem("chosenPlace")&&localStorage.setItem("chosenPlace",JSON.stringify($rootScope.chosenPlace)),$scope.geolocationLoading=!1,$state.go($attrs.state,{latlng:position.coords.latitude+","+position.coords.longitude,address:$rootScope.chosenPlace.formatted_address})):alert("Sorry, there was an issue getting an address for your current location. Please try typing your address above.")})}else $scope.geolocationLoading=!1,$state.go($attrs.state,{latlng:position.coords.latitude+","+position.coords.longitude})}):alert("Geolocation is not supported by this browser.")},$scope.chosenUpdate=function(chosenPlace){null!=chosenPlace&&($rootScope.chosenPlace=chosenPlace,$scope.chosenPlace=chosenPlace,console.log("CHOSEN: "+$rootScope.chosenPlace.geometry.location.lat()),$state.go($attrs.state,{latlng:$rootScope.chosenPlace.geometry.location.lat()+","+$rootScope.chosenPlace.geometry.location.lng(),address:$attrs.requireAddress?$rootScope.chosenPlace.formatted_address:null}))}}}}).directive("pcLocateSave",function($rootScope,$state){return{restrict:"E",/*scope: {
        state: '=',
        requireAddress: '=',
        place: '@'
    },*/
replace:!0,templateUrl:"views/apps/311App/pc-locate-save.html",link:function($scope,$element,$attrs){
// Save address button. Default address is set in 311app.js
$scope.saveAddress=!!localStorage.getItem("chosenPlace"),$scope.toggleSaveAddress=function(){$scope.saveAddress?localStorage.setItem("chosenPlace",JSON.stringify($rootScope.chosenPlace)):localStorage.removeItem("chosenPlace")},
// Toggle save address help info
$scope.showSaveInfo=!1,$scope.toggleSaveInfo=function($e){$e.preventDefault(),$scope.showSaveInfo=!$scope.showSaveInfo}}}}),angular.module("311App").directive("serviceHourly",function($rootScope,$state){return{restrict:"A",
//replace: true,
scope:{item:"="},templateUrl:"views/apps/311App/local/service-hourly.html",link:function($scope,$element,$attrs){if($scope.item.address){var address=$scope.item.address+", "+$rootScope.location.city+", "+$rootScope.location.state;$scope.item.directions="//maps.google.com/maps/dir//"+encodeURIComponent(address)}$scope.item.label=void 0!=$scope.item.label?$scope.item.label:["Closed","Open"],$scope.toggleHours=function($e){$e.preventDefault(),$scope.hoursActive=void 0==$scope.hoursActive||!$scope.hoursActive},$scope.holidays=$rootScope.holidays,$scope.toggleHolidays=function($e){$e.preventDefault(),$scope.holidaysActive=void 0==$scope.holidaysActive||!$scope.holidaysActive,$scope.holidaysActive&&($scope.hoursActive=!1)}}}}).directive("serviceLocation",function($rootScope,$state,Local){return{restrict:"A",
//replace: true,
scope:{item:"="},templateUrl:"views/apps/311App/local/service-location.html",link:function($scope,$element,$attrs){console.log("serviceLocation"),$scope.data=null,Local.get($rootScope.chosenPlace,$scope.item).$promise.then(function(data){"success"===data.status?$scope.items=data.result:$scope.items=!1}),$scope.hoursActive=!1,$scope.toggleHours=function($e){$e.preventDefault(),$scope.hoursActive=!$scope.hoursActive},$scope.disclaimerActive=!1,$scope.toggleDisclaimer=function($e){$e.preventDefault(),$scope.showDisclaimer=!$scope.showDisclaimer}}}}).directive("serviceNeighborhood",function($rootScope,$state,Local){return{restrict:"A",
//replace: true,
scope:{item:"="},templateUrl:"views/apps/311App/local/service-neighborhood.html",link:function($scope,$element,$attrs){console.log("serviceNeighborhood"),$scope.data=null,Local.get($rootScope.chosenPlace,$scope.item).$promise.then(function(data){if("success"===data.status){obj={};for(var i=0;i<data.result.length;i++)obj[data.result[i].label.toLowerCase()]=data.result[i].value;$scope.data=obj,console.log("NEIGHBORHOOD",obj)}else $scope.data=!1})}}}).directive("serviceBoundary",function($rootScope,$state,Local){return{restrict:"A",
//replace: true,
scope:{item:"="},templateUrl:"views/apps/311App/local/service-boundary.html",link:function($scope,$element,$attrs){console.log("boundary"),$scope.data=0,Local.get($rootScope.chosenPlace,$scope.item).$promise.then(function(data){if("success"===data.status){obj={};for(var i=0;i<data.result.length;i++)obj[data.result[i].label.toLowerCase()]=data.result[i].value;$scope.data=obj.boundary?1:-1,$scope.place=$rootScope.chosenPlace}else $scope.data=!1})}}}).directive("serviceOfficials",function($rootScope,$state,$filter,GoogleRepresentatives){return{restrict:"A",
//replace: true,
scope:{item:"="},templateUrl:"views/apps/311App/local/service-officials.html",link:function($scope,$element,$attrs){$scope.data=null,$scope.latlng=$rootScope.chosenPlace.geometry.location.lat()+","+$rootScope.chosenPlace.geometry.location.lng(),GoogleRepresentatives.get().$promise.then(function(data){console.log("REPS",data);for(var officials=[],pattern=void 0!=$scope.item.pattern?$scope.item.pattern:"council_district|place",i=0;i<data.offices.length;i++)if(data.offices[i].divisionId.match(new RegExp(pattern)))for(var j=0;j<data.offices[i].officialIndices;j++){var index=data.offices[i].officialIndices[j];void 0!=index&&(data.officials[index].office=data.offices[i].name,officials.push(data.officials[index]))}$scope.officials=officials,console.log("OFFICIALS",officials)}),$scope.localOfficial=function(office,official){return console.log(office,official),office.divisionId===official.divisionId}}}}).directive("serviceWeather",function($rootScope,$state,WeatherForecast){return{restrict:"A",
//replace: true,
scope:{item:"="},templateUrl:"views/apps/311App/local/service-weather.html",link:function($scope,$element,$attrs){$scope.data=null,
//$scope.latlng = $rootScope.chosenPlace.geometry.location.lat +','+ $rootScope.chosenPlace.geometry.location.lng;
WeatherForecast.get().$promise.then(function(data){console.log("FORECAST",data),$scope.data=data})}}}),angular.module("311App").directive("searchGranicus",function($rootScope,$state,$timeout,$window,GranicusSearch){return{restrict:"A",
//replace: true,
scope:{term:"=",num:"@"},templateUrl:"views/apps/311App/search/granicus.html",link:function($scope,$element,$attrs){var num=$attrs.num?$attrs.num:5;$scope.num=num,$scope.items=!1;var granicusUrl="//"+_.get(Proud,"settings.proud_actions_app.global.search_granicus_site"),timeoutPromise=!1;$scope.$watch("term",function(newValue,oldValue){newValue?(
// Add a slight delay
$timeout.cancel(timeoutPromise),timeoutPromise=$timeout(function(){$scope.granicusSearchUrl=granicusUrl+"/ViewSearchResults.php?view_id=2&types%5BClip%5D=on&types%5BAgendaItem%5D=on&allwords="+newValue;var params={q:newValue,sort:[{datetime:"desc"}]};GranicusSearch.query(params).$promise.then(function(data){void 0!=data.hits&&data.hits.total>0&&data.hits.hits.length?($scope.items=data.hits.hits,$scope.more=!1,// @todo: data.hits.hits.length > num;
$scope.num=num):$scope.items=!1})},500)):$scope.items=!1},!0),$scope.go=function(item,$e){$e.preventDefault();var url=granicusUrl+"/MediaPlayer.php?clip_id="+item._source.video_id+"&meta_id="+item._id;$window.open(url,"granicus","width=800,height=700")},$scope.getTitle=function(item){var text=item._source.name?item._source.name:item._source.video_name;
//var matches = text.match(/([0-9]+\.?\s)([a-zA-Z0-9\(\)\s]+)/);
//text = matches != null && matches[2] != undefined ? matches[2] : text;
return text},$scope.activeDetails=-1,$scope.showDetails=function(index,$e){$e.preventDefault(),$scope.activeDetails=$scope.activeDetails==index?-1:index},$scope.updateNum=function($e){$e.preventDefault(),$scope.more=!1,$scope.num=100},$scope.granicusSearch=function(url,$e){$e.preventDefault(),$window.open(url,"granicus","width=800,height=700")}}}}),angular.module("311App").config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){
//.when('', '/answers');
$stateProvider.state("city.search",{url:"/search",data:{doScroll:!1,// No scroll on route change
undoMainToggle:!0,// Force "offcanvas" class off
title:"Check Status"},templateUrl:"views/apps/311App/search/search.html",controller:function($scope,$rootScope,$state,$window,$sce,Search){$scope.term="",$scope.results=!1,$scope.loading=!1,$scope.additional=_.get(Proud,"settings.proud_actions_app.global.search_additional"),$scope.trustHtml=function(html){return $sce.trustAsHtml(html)},$scope.autocomplete=function(){$scope.loading=!0,Search.query({term:$scope.term}).$promise.then(function(data){$scope.results=data,$scope.loading=!1})},$scope.go=function(item,$e){if($e.preventDefault(),void 0!=item.action_attr&&""!=item.action_attr){var hash="city/"+item.action_attr+item.action_hash;$window.location.hash=hash}else $window.open(item.url)},$scope.googleSearch=function($e){$e.preventDefault();var searchPrefix=_.get(Proud,"settings.proud_actions_app.global.search_prefix")||"https://www.google.com/search?q=",searchSuffix=_.get(Proud,"settings.proud_actions_app.global.search_suffix")||"",url=searchPrefix+encodeURIComponent($scope.term+searchSuffix);$window.open(url)}}})}]),angular.module("311App").config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){
// Redirect if on local parent
$urlRouterProvider.when(/city\/local$/i,["$match","$stateParams","$rootScope",function($match,$stateParams,$rootScope){if(!$rootScope.chosenPlace){var chosenPlace=localStorage.getItem("chosenPlace");$rootScope.chosenPlace=chosenPlace?JSON.parse(chosenPlace):null}return $rootScope.chosenPlace?"/city/local/location/"+$rootScope.chosenPlace.geometry.location.lat+","+$rootScope.chosenPlace.geometry.location.lng:"/city/local/address"}]),$stateProvider.state("city.local",{url:"/local",template:"<div ui-view></div>",data:{title:"Vote",// Sets meta title
description:"About the about",// Sets different meta description
keywords:"About, this, page",// Sets different meta keywords,
doScroll:!1,// no scroll on route change
undoMainToggle:!0},resolve:{services:function($rootScope){
//var instance = 'settings.proud_actions_app.instances.' + $rootScope.appId;
return _.get(Proud,"settings.proud_actions_app.global.services")}}}).state("city.local.address",{url:"/address",templateUrl:"views/apps/311App/local/local-address.html",data:{title:"Vote",// Sets meta title
description:"About the about",// Sets different meta description
keywords:"About, this, page",// Sets different meta keywords,
doScroll:!1,// no scroll on route change
undoMainToggle:!0},controller:function($scope,$rootScope,$state,$window,services){$scope.city=$rootScope.location.city,$scope.services=services,
//$scope.place = null;
//$scope.chosenPlace = $rootScope.chosenPlace;
//var instance = 'settings.proud_actions_app.instances.' + $rootScope.appId;
//var bgImage = _.get(Proud, instance + '.background');
//$scope.bgStyle = bgImage ? 'background: url('+ bgImage +');background-size: 100%;min-height: 400px;' : '';
$scope.showLocalInfo=!1,$scope.toggleLocalInfo=function($e){$e.preventDefault(),$scope.showLocalInfo=!$scope.showLocalInfo}}}).state("city.local.location",{url:"/location/:latlng",templateUrl:"views/apps/311App/local/local-location.html",data:{title:"Local",// Sets meta title
description:"About the about",// Sets different meta description
keywords:"About, this, page",// Sets different meta keywords,
doScroll:!1,// no scroll on route change
undoMainToggle:!0},resolve:{data:getChosenPlace},controller:function($scope,$rootScope,$state,$window,data,services){
// Structure the address data
$scope.place=data,$scope.services=_.filter(services,function(service){return"boundary"==service.title.toLowerCase()?($scope.boundary=service,!1):"neighborhood"!=service.title.toLowerCase()||($scope.neighborhood=service,!1)})}}).state("city.local.officials",{url:"/officials/:latlng",templateUrl:"views/apps/311App/local/local-officials.html",data:{title:"Local",// Sets meta title
description:"About the about",// Sets different meta description
keywords:"About, this, page",// Sets different meta keywords,
doScroll:!1,// no scroll on route change
undoMainToggle:!0},resolve:{data:getChosenPlace},controller:function($scope,$rootScope,$state,$window,GoogleRepresentatives,data){var sections=[{pattern:"place"},{pattern:"county"},{pattern:"state"},{pattern:"country"}];$scope.place=data,$scope.latlng=$state.params.latlng,$scope.sections,GoogleRepresentatives.get().$promise.then(function(data){
// Filter out to only the officials that match $scope.item.pattern and reformat object.
for(var s=0;s<sections.length;s++){sections[s].officials=[];for(var d in data.divisions)if(null!=data.divisions[d]&&d.match(new RegExp(sections[s].pattern))){if(sections[s].name=void 0==sections[s].name?data.divisions[d].name:sections[s].name,void 0!=data.divisions[d].officeIndices)for(var j=0;j<data.divisions[d].officeIndices.length;j++)for(var officeIndex=data.divisions[d].officeIndices[j],i=0;i<data.offices[officeIndex].officialIndices;i++){var index=data.offices[officeIndex].officialIndices[i];void 0!=index&&null!=data.officials[index]&&(data.officials[index].office=data.offices[officeIndex].name,sections[s].officials.push(data.officials[index]),data.officials[index]=null)}// if
data.divisions[d]=null}}// for
$scope.sections=sections}),/*$scope.sections({
              
            })*/
$scope.localOffice=function(matches,office){for(var i=0;i<matches.length;i++)if(office.divisionId.indexOf(matches[i])!=-1)return!0;return!1},$scope.toggleAddress=function(i,$e){$e.preventDefault(),$scope.data.officials[i].addressActive=void 0==$scope.data.officials[i].addressActive||!$scope.data.officials[i].addressActive}}})}]);
// A resolve callback function to ensure we have an address
var getChosenPlace=function($stateParams,$rootScope,GoogleCivicInfo){if($rootScope.chosenPlace=null,$rootScope.chosenPlace)return $rootScope.chosenPlace=addAddressAssoc($rootScope.chosenPlace),$rootScope.chosenPlace;var latlng=$stateParams.latlng.split(",");latlng={lat:parseFloat(latlng[0]),lng:parseFloat(latlng[1])};var deferred=$.Deferred(),geocoder=new google.maps.Geocoder;return geocoder.geocode({location:latlng},function(results,status){"OK"===status?($rootScope.chosenPlace=addAddressAssoc(results[0]),localStorage.getItem("chosenPlace")&&localStorage.setItem("chosenPlace",JSON.stringify($rootScope.chosenPlace)),deferred.resolve($rootScope.chosenPlace)):deferred.reject(status)}),deferred.promise()},addAddressAssoc=function(data){data.address_assoc={};for(var i in data.address_components){switch(data.address_components[i].types[0]){case"route":data.address_assoc.route_short=data.address_components[i].short_name}data.address_assoc[data.address_components[i].types[0]]=data.address_components[i].long_name}return data.address_assoc.administrative_area_level_2=data.address_assoc.administrative_area_level_2.replace("County",""),data.name=void 0!=data.name?data.name:data.formatted_address,data};angular.module("311App").config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$stateProvider.state("city.faq",{url:"/answers",templateUrl:"views/apps/311App/faq/faq.html",data:{title:"FAQ",// Sets meta title
description:"About the about",// Sets different meta description
keywords:"About, this, page",// Sets different meta keywords,
doScroll:!1,// no scroll on route change
undoMainToggle:!0},resolve:{terms:function($stateParams,$rootScope,TaxonomyTerm){return TaxonomyTerm.query({vocabulary:"faq-topic"}).$promise.then(function(data){return data})}},controller:function($scope,$rootScope,$state,terms,$window){$scope.terms=terms,$scope.active=null,$scope.childOpen=!1,$scope.open=function(item){$window.ga("send",{hitType:"event",eventCategory:"ActionsApp",eventAction:"category open",eventLabel:item.slug}),$scope.active=item},$scope.openChildren=function(){$scope.childOpen=!0}}}).state("city.faq.child",{url:"/:slug",templateUrl:"views/apps/311App/faq/faq-child.html",data:{title:"FAQ",// Sets meta title
description:"About the about",// Sets different meta description
keywords:"About, this, page",// Sets different meta keywords
undoMainToggle:!1},resolve:{nodes:function($stateParams,$rootScope,Post){
// @todo: put this in resolve
return Post.query({postType:"questions","filter[faq-topic]":$stateParams.slug}).$promise.then(function(data){return data})}},controller:function($scope,$rootScope,$state,$filter,terms,nodes){
// Order to top the active item on first load
if($scope.activeTerm=$filter("termBySlug")(terms,$state.params.slug),$scope.activeParent=$filter("termById")(terms,$scope.activeTerm.parent),$state.params.postSlug&&"list"!==$state.params.postSlug)for(var i=0;i<nodes.length;i++)if(nodes[i].slug==$state.params.postSlug){var element=nodes[i];nodes.splice(i,1),nodes.splice(0,0,element)}$state.go("city.faq.child.answers",{nid:"list"})}}).state("city.faq.child.answers",{url:"/:postSlug",templateUrl:"views/apps/311App/faq/faq-child-answers.html",data:{title:"FAQ",// Sets meta title
description:"About the about",// Sets different meta description
keywords:"About, this, page"},controller:function($scope,$rootScope,$state,$filter,$window,nodes){$scope.activeSlug="list"!=$state.params.postSlug?$state.params.postSlug:null,$scope.nodes=nodes,
// Click event for heart button
$scope.heartClick=function(node,e){e.preventDefault(),node.hearted=void 0==node.hearted||!node.hearted,$window.ga("send",{hitType:"event",eventCategory:"Score",eventLabel:node.title.rendered,eventAction:$rootScope.analyticsUrl,eventValue:node.hearted?5:-5}),node.hearted&&$window.ga("send",{hitType:"event",eventCategory:"Heart",eventLabel:node.title.rendered,eventAction:$rootScope.analyticsUrl,eventValue:node.hearted?1:-1})}}})}]),angular.module("311App").config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){
//.when('', '/answers');
$stateProvider.state("city.status",{url:"/status",data:{doScroll:!1,// No scroll on route change
undoMainToggle:!0,// Force "offcanvas" class off
title:"Check Status"},templateUrl:"views/apps/311App/issues/issue-status.html",controller:function($scope,$rootScope,$state,$timeout,Issue){
//$scope.code = 'd2a6-1'; // @todo: default value, remove
//console.log('a', jQuery('#map-wrapper'));
$scope.tabClick=function(tab,e){e.preventDefault(),$scope.activeTab=tab},$scope.city=$rootScope.activeCity,$timeout(function(){$scope.showMap=jQuery(".widget-proud-map-app").length},2e3),
//console.log($scope);
$scope.clickMap=function(e){jQuery("#map-wrapper").trigger("click"),jQuery("#menu-ui a:last").trigger("click"),e.preventDefault()},
// Get myIssues
$scope.hasMyIssues=!1;var local=localStorage.getItem("reportedIssues");local===-1&&($scope.hasMyIssues=-1),local&&local!==-1&&($scope.myIssues=JSON.parse(local),$scope.activeTab="me",$scope.hasMyIssues=!0),
// Get recent issues
$scope.recentIssues=[],$scope.recentLoading=!0,Issue.query().$promise.then(function(data){$scope.recentLoading=!1,$scope.recentIssues=data}),$scope.activeTab=$scope.hasMyIssues?"me":"recent",$scope.issueThumb=function(item){return item.thumb?item.thumb:"https://api.mapbox.com/v4/mapbox.emerald/"+item.lng+","+item.lat+",13/300x300@2x.png?access_token="+$rootScope.mapboxAccessToken},
// Get recent issues (preload)
// No remember checkbox callback
$scope.showLocalCheckbox=!0,$scope.toggleSave=function(){var local=localStorage.getItem("reportedIssues");local=local===-1?[]:-1,localStorage.setItem("reportedIssues",local),local==-1&&(alert("We have deleted your saved issues and will not store issues you submit on this device in the future."),$scope.showLocalCheckbox=!1)}}}).state("city.status.item",{url:"/:code?saved",data:{undoMainToggle:!1},templateUrl:"views/apps/311App/issues/issue-status-result.html",controller:function($scope,$rootScope,$state,$window,Issue){$scope.code=$state.params.code,$scope.currentUrl="",$scope.loading=!0,$scope.error=!1,$scope.saved=$state.params.saved,Issue.get({code:$state.params.code}).$promise.then(function(data){$scope.loading=!1,void 0!=data?($scope.item=data,$scope.currentUrl=$window.location.href.substring(0,$window.location.href.indexOf("?"))):$scope.error=!0})}}).state("city.report",{url:"/report",data:{doScroll:!1,// No scroll on route change
undoMainToggle:!0,// Force "offcanvas" class off
title:"Report Issue"},templateUrl:"views/apps/311App/issues/issue-create-categories.html",resolve:{services:function($stateParams,IssueTypes,Post,$rootScope){var issue=_.get(Proud,"settings.proud_actions_app.global.issue")||{service:"seeclickfix"};return"seeclickfix"==issue.service?IssueTypes.query().$promise.then(function(data){return void 0!=data.request_types?data.request_types:null}):Post.query({postType:"issues"}).$promise.then(function(data){return data})}},controller:function($scope,$rootScope,$state,services){var issue=_.get(Proud,"settings.proud_actions_app.global.issue")||{service:"seeclickfix"};$scope.service=issue.service,$scope.types=services}}).state("city.report.iframe",{url:"/embed/:slug",data:{doScroll:!1,// No scroll on route change
undoMainToggle:!0,// Force "offcanvas" class off
title:"Report Issue"},templateUrl:"views/apps/311App/issues/issue-create-iframe.html",resolve:{post:function($stateParams,$filter,services){return $filter("filter")(services,{slug:$stateParams.slug})[0]}},controller:function($scope,$rootScope,$state,$sce,post){$scope.post=post,$scope.trustSrc=function(post){var src=post.meta.form?$rootScope.gravityformsIframe+post.meta.form:post.meta.iframe;return $sce.trustAsResourceUrl(src)}}}).state("city.report.map",{url:"/:type",data:{undoMainToggle:!1,// Force "offcanvas" class off
undoChildToggle:1},templateUrl:"views/apps/311App/issues/issue-create-map.html",controller:function($scope,$rootScope,$state,$http){$scope.type=$state.params.type,$scope.next=function(){if(void 0!=$scope.marker&&$scope.marker){var latlng=$scope.marker.getLatLng();$state.go("city.report.map.details",{lat:latlng.lat,lng:latlng.lng})}else alert("Please enter an address, or click the Locate button to use your current location.")},$scope.$watch("config",function(value){L.mapbox.accessToken=$rootScope.mapboxAccessToken;var map=new L.mapbox.Map("issue-map",$rootScope.mapboxMap,{center:new L.LatLng($rootScope.location.lat,$rootScope.location.lng),zoom:15,scrollWheelZoom:!1});$scope.marker=null;var addMarker=function(self){var latlng=void 0!=self.latlng?self.latlng:new L.LatLng(self.feature.center[1],self.feature.center[0]);$scope.marker=L.marker(latlng,{icon:L.mapbox.marker.icon({"marker-color":"ff8888"}),draggable:!0}).addTo(map),$scope.$apply()};
// Add marker when the map is clicked (if it hasn't already been added)
map.on("click",function(self){null===$scope.marker&&addMarker(self)}),
// Add geocode control, add marker when selected
map.addControl(L.mapbox.geocoderControl("mapbox.places",{keepOpen:!0,autocomplete:!0}).on("select",addMarker).on("autoselect",addMarker)),
// Add locate control, add marker when located
L.control.locate({drawCircle:!0}).addTo(map),map.on("locationfound",addMarker)})}}).state("city.report.map.details",{url:"/details?lat&lng",data:{undoChildToggle:!1},templateUrl:"views/apps/311App/issues/issue-create-details.html",resolve:{data:function($stateParams,$rootScope,IssueFields){return IssueFields.get({type:$stateParams.type}).$promise.then(function(data){return{categoryTitle:data.title,fields:data.questions}})}},controller:function($scope,$rootScope,$state,data,Issue,IssueAddress){$scope.type=$state.params.type,$scope.form={request_type_id:$scope.type,lat:$state.params.lat,lng:$state.params.lng,answers:{}},$scope.fields=data.fields,$scope.form.category=data.categoryTitle,$scope.form.address=data.address,$scope.submitLabel="Continue with SeeClickFix",$scope.guestAllowed=!0,$scope.form.guest=!1,$scope.toggleGuest=function(e){e.preventDefault(),$scope.form.guest=!$scope.form.guest,$scope.submitLabel="Submit"},$scope.form.address="",IssueAddress.get({type:$state.params.type,lat:$state.params.lat,lng:$state.params.lng}).$promise.then(function(data){$scope.form.address=data.address}),$scope.submit=function(data){/*var issue = new TrackIssue(data);
              issue.$save(function(data, putResponseHeaders) {
                console.log(data);
                //u => saved user object
                //putResponseHeaders => $http header getter
              });*/
if(data.guest){var issue=new Issue(data);issue.$save(function(data){
// Save issue history in localStorage
var local=localStorage.getItem("reportedIssues");
//local = '[]';
local!==-1&&(local=local?JSON.parse(local):[],local.push({created_at:data.created_at,title:data.summary,id:data.id,address:data.address}),localStorage.setItem("reportedIssues",JSON.stringify(local))),
// Redirect
$state.go("city.status.item",{code:data.id,saved:local===-1?1:2})},function(err){
// @todo: better error handling here
$scope.errors="";for(var i in err.data.errors)$scope.errors+="<div>"+err.data.errors[i][0]+"</div>"})}else{var url="https://test.seeclickfix.com/oauth/authorize?response_type=code&client_id=YOUR_CLIENT_ID&redirect_uri=http://api.proudcity.com:4000";window.open(url,"authorize","width=400,height=420")}}}})}]),angular.module("311App").config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$stateProvider.state("city.payments",{templateUrl:"views/apps/311App/payment/payment.html",data:{doScroll:!1,// No scroll on route change
undoMainToggle:!0,// Force "offcanvas" class off
title:"Payments"},url:"/payments",resolve:{posts:function($stateParams,Post){return Post.query({postType:"payments"}).$promise.then(function(data){return data})}},controller:function($scope,$rootScope,$state,posts){$scope.posts=posts}}).state("city.payments.type",{templateUrl:"views/apps/311App/payment/payment-type.html",url:"/:slug",resolve:{post:function($stateParams,$filter,posts){return $filter("filter")(posts,{slug:$stateParams.slug})[0]}},controller:function($scope,$rootScope,$state,post,Payment){
//console.log(post);
$scope.post=post,$scope.demoInfo=!1,$scope.payment={id:"",amount:""},$scope.idClass="",$scope.demoInfoToggle=function(e){$scope.demoInfo=!$scope.demoInfo,e.preventDefault()},
// Talk to invoice API
$scope.$watch("payment.id",function(){""!=$scope.payment.id&&$scope.payment.id.length>3?($scope.idClass="has-warning",Payment.get({city:void 0!=$scope.location?$scope.location.city:null,state:void 0!=$scope.location?$scope.location.state:null,id:$scope.payment.id},function(data){void 0!=data.amount?($scope.payment.amount=data.amount,$scope.payment.name=data.name,$scope.idClass="has-success"):($scope.payment.amount="",$scope.idClass="has-error")})):$scope.idClass=""}),
// Submit
$scope.submit=function(payment){window.location=$scope.post.link+"?amount="+$scope.payment.amount+"&id="+$scope.payment.id}}}).state("city.payments.success",{templateUrl:"views/apps/311App/payment/payment-success.html",url:"/:nid/:token",resolve:{post:function($stateParams,$filter,posts){return $filter("filter")(posts,{nid:$stateParams.nid})[0]}},controller:function($scope,$rootScope,$state,post,Payment){}})}]),angular.module("311App").config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$stateProvider.state("city.gravityform",{url:"/form/:id",data:{doScroll:!1,// No scroll on route change
undoMainToggle:!0,// Force "offcanvas" class off
title:"Complete form"},templateUrl:"views/apps/311App/post/gravityform-iframe.html",/*resolve: {
            post: function($stateParams, $filter, Post) {
              var key = !isNaN(parseInt($stateParams.slug)) ? 'id' : 'slug';
              return Post.get({
                key: $stateParams.slug
              }).$promise.then(function(data) {
                return data;
              });
            }
          },*/
controller:function($scope,$rootScope,$state,$sce,$window){
//console.log(post);
//$scope.post = post;
$scope.trustSrc=function(post){
//console.log(post);
var src=$rootScope.gravityformsIframe+$state.params.id;return console.log("IFRAME",src),$sce.trustAsResourceUrl(src)},$scope.back=function($e){$e.preventDefault(),$window.history.back()}}})}]),angular.module("311App").config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$stateProvider.state("city.map",{templateUrl:"views/apps/311App/map/map.html",data:{doScroll:!1,// No scroll on route change
undoMainToggle:!0,// Force "offcanvas" class off
title:"Maps"},resolve:{layers:function($rootScope){return _.get(Proud,"settings.proud_actions_app.global.map_layers")||[]}},url:"/maps",controller:function($scope,$rootScope,$state,layers){$scope.layers=layers,$scope.go=function(item,$e){switch($e.preventDefault(),item.type){case"wordpress":$state.go("city.map.wordpress",{slug:item.slug});break;case'"googlePlaces"':$state.go("city.map.googlePlaces",{term:item.term});break;default:$state.go("city.map."+item.type)}}}}).state("city.map.view",{templateUrl:"views/apps/311App/map/view.html",data:{doScroll:!1,// No scroll on route change
undoMainToggle:!0,// Force "offcanvas" class off
title:"View map"},url:"/:slug",controller:function($scope,$rootScope,$state,$filter,layers){$scope.layerSlug=$state.params.slug,$scope.layer=$filter("filter")($scope.layers,{slug:$state.params.slug})[0],$scope.layerLoading=!1}}).state("city.map.view.wordpress",{template:" ",//'views/apps/311App/map/listing.html',
data:{doScroll:!1,// No scroll on route change
undoMainToggle:!0,// Force "offcanvas" class off
title:"Listing"},url:"/wordpress/:listingSlug",controller:function($scope,$rootScope,$state,$filter,layers){$scope.$parent.listingSlug=$state.params.listingSlug}})}]),angular.module("311App").config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$urlRouterProvider.when("/vote","/vote/address"),$stateProvider.state("city.vote",{url:"/vote",template:"<div ui-view></div>",data:{title:"Vote",// Sets meta title
description:"About the about",// Sets different meta description
keywords:"About, this, page",// Sets different meta keywords,
doScroll:!1,// no scroll on route change
undoMainToggle:!0},controller:function($scope,$rootScope,$state,$window){/*$scope.$on('$stateChangeStart', function(event, toState, toParams) {

              alert('asdf');
            });*/
/*
            $scope.$on('$viewContentLoaded', function(event){

              
            });*/
// We just need to determine if we redirect to city.vote
$rootScope.$on("$stateChangeSuccess",function(event,toState,toParams,fromState,fromParams){"city.vote"==toState.name&&$state.go("city.vote.address")}),"city.vote"==$state.current.name&&$state.go("city.vote.address")}}).state("city.vote.embed",{url:"/embed",templateUrl:"views/apps/311App/vote/vote-embed.html",data:{title:"Embed",// Sets meta title
description:"About the about",// Sets different meta description
keywords:"About, this, page",// Sets different meta keywords,
doScroll:!1,// no scroll on route change
undoMainToggle:!0}}).state("city.vote.address",{url:"/address",templateUrl:"views/apps/311App/vote/vote-address.html",data:{title:"Vote",// Sets meta title
description:"About the about",// Sets different meta description
keywords:"About, this, page",// Sets different meta keywords,
doScroll:!1,// no scroll on route change
undoMainToggle:!0},controller:function($scope,$rootScope,$state,$window){$scope.place=null,$scope.chosenPlace=null,$rootScope.chosenPlace=null,$scope.chosenUpdate=function(){null!=$rootScope.chosenPlace&&($scope.chosenPlace=$rootScope.chosenPlace,$state.go("city.vote.location",{latlng:$rootScope.chosenPlace.geometry.location.lat()+","+$rootScope.chosenPlace.geometry.location.lng(),address:$rootScope.chosenPlace.formatted_address}))}}}).state("city.vote.location",{url:"/:latlng/:address",templateUrl:"views/apps/311App/vote/vote-wrapper.html",data:{title:"Vote",// Sets meta title
description:"About the about",// Sets different meta description
keywords:"About, this, page",// Sets different meta keywords,
doScroll:!1,// no scroll on route change
undoMainToggle:!0},resolve:{data:function($stateParams,$rootScope,GoogleCivicInfo){return GoogleCivicInfo.query({address:$stateParams.address}).$promise.then(function(data){if(data.election){var date=new Date(data.election.electionDay),monthNames=["Jan","Feb","March","April","May","June","July","Aug","Sep","Oct","Nov","Dec"];data.election.date={days:Math.round((date-new Date)/864e5),month:monthNames[date.getUTCMonth()],day:date.getUTCDate(),year:date.getUTCFullYear()}}return data})}},controller:function($scope,$rootScope,$state,$window,data){$state.go("city.vote.location.how"),data.election&&($scope.date=data.election.date)}}).state("city.vote.location.how",{url:"/how",templateUrl:"views/apps/311App/vote/vote-how.html",data:{title:"How to Vote",// Sets meta title
description:"About the about",// Sets different meta description
keywords:"About, this, page",// Sets different meta keywords,
doScroll:!1,// no scroll on route change
undoMainToggle:!0},controller:function($scope,$rootScope,$state,$window,data){
//console.log(data);
var home=$state.params.latlng.split(",");home=new google.maps.LatLng(parseFloat(home[0]),parseFloat(home[1]));var geocoder=new google.maps.Geocoder,bounds=new google.maps.LatLngBounds,myOptions={zoom:14,center:home,mapTypeId:google.maps.MapTypeId.ROADMAP},map=new google.maps.Map(document.getElementById("google-map"),myOptions);
// Add home pin
// Custom icons from https://sites.google.com/site/gmapsdevelopment/
new google.maps.Marker({map:map,position:home,title:"Your address".toUpperCase(),icon:"//maps.google.com/mapfiles/kml/pal3/icon31.png",shadow:"//maps.google.com/mapfiles/kml/pal3/icon31s.png"}),bounds.extend(home);
// Helper function
var marker;$scope.addMarker=function(address,label,color){geocoder.geocode({address:address},function(results,status){"OK"==status&&(marker=new google.maps.Marker({map:map,position:results[0].geometry.location,title:label.toUpperCase(label),icon:"//raw.githubusercontent.com/Concept211/Google-Maps-Markers/master/images/marker_"+color+".png"}),bounds.extend(marker.getPosition()),map.fitBounds(bounds))})},
// Add polling place pins
data.pollingLocations="array"==typeof data.pollingLocations?data.pollingLocations:[];var combinedLocations=data.pollingLocations.concat(data.earlyVoteSites);if(combinedLocations=void 0==combinedLocations[0]?[]:combinedLocations,void 0!=combinedLocations&&combinedLocations.length>0){var addr,address;for(var i in combinedLocations)addr=combinedLocations[i].address,address=addr.line1+", "+(void 0!=addr.line2?addr.line2+", ":"")+addr.city+", "+addr.state+" "+addr.zip,$scope.addMarker(address,"Polling place: "+addr.locationName,i>=data.pollingLocations.length?"green":"orange");$scope.directionsLink="//maps.google.com/maps/dir/"+encodeURIComponent($state.params.latlng)+"/"+encodeURIComponent(address),$scope.address=combinedLocations[0].address,$scope.hours=combinedLocations[0].pollingHours.replace(/\n/g,"<br>");var arrHrs=$scope.hours.split("<br>");$scope.shortHours=arrHrs.length>3?[arrHrs[0],arrHrs[1],arrHrs[2]].join("<br>"):null,$scope.longHours=!1,$scope.sources=combinedLocations[0].sources,$scope.isEarly=i>=data.pollingLocations.length}$scope.links=data.state?data.state[0].electionAdministrationBody:null,$scope.date=data.election.date,$scope.disclaimer=!1,$scope.toggleDisclaimer=function($e){$e.preventDefault(),$scope.disclaimer=!$scope.disclaimer},$scope.getDirections=function($e){$e.preventDefault(),window.open($scope.directionsLink)},$scope.toggleHours=function($e){$e.preventDefault(),$scope.longHours=!$scope.longHours},$scope.mapScroll=function($e){$e.preventDefault(),document.getElementById("google-map").scrollIntoView(!0)}}}).state("city.vote.location.issues",{url:"/issues",templateUrl:"views/apps/311App/vote/vote-issues.html",data:{title:"Issues",// Sets meta title
description:"About the about",// Sets different meta description
keywords:"About, this, page",// Sets different meta keywords,
doScroll:!1,// no scroll on route change
undoMainToggle:!0},controller:function($scope,$rootScope,$state,$filter,data){$scope.contests=$filter("filter")(data.contests,{type:"Referendum"}),$scope.active=null,$scope.setActive=function(val,$e){$e.preventDefault(),$scope.active=val}}}).state("city.vote.location.candidates",{url:"/candidates",templateUrl:"views/apps/311App/vote/vote-candidates.html",data:{title:"Candidates",// Sets meta title
description:"About the about",// Sets different meta description
keywords:"About, this, page",// Sets different meta keywords,
doScroll:!1,// no scroll on route change
undoMainToggle:!0},controller:function($scope,$rootScope,$state,$filter,data){$scope.contests=$filter("filter")(data.contests,{type:"General"}).slice().reverse(),$scope.googleSearch=function(name,loc,$e){$e.preventDefault(),window.open("//google.com/search?q="+encodeURIComponent(name))}}})}]),angular.module("311App").config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$stateProvider.state("city.custom",{template:'<div ng-bind-html="content" class="slide-left-2"></div>',data:{doScroll:!1,// No scroll on route change
undoMainToggle:!0},url:"/tab",controller:function($scope,$rootScope,$state,$sce){$scope.content=$sce.trustAsHtml(_.get(Proud,"settings.proud_actions_app.instances."+$rootScope.appId+".custom_content")||"")}})}])}(jQuery);